"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const gulp_1 = require("gulp");
const through2 = require("through2");
const rename = require("gulp-rename");
const json_to_ts_1 = require("json-to-ts");
const string_fun_1 = require("./string-fun");
const config = () => {
    // 创建stream对象，每个文件都会经过这个stream对象
    const stream = through2.obj(function (chunk, _, callback) {
        this.push(chunk);
        const sf = string_fun_1.StringFun.create(JSON.parse(chunk.contents.toString()).path);
        chunk.contents = Buffer.from(json_to_ts_1.default(sf.demo, { rootName: 'IStringFun' })
            .map(s => `export ${s.replace(/\?: any/g, ': void')}`)
            .join('\n'));
        callback(null, chunk);
    });
    return stream;
};
const getPath = () => {
    const idx = process.argv.indexOf('--src') === -1
        ? -1
        : process.argv.indexOf('--src') + 1;
    return process.argv[idx] || '.str.json';
};
const path = getPath();
const getConfigInterface = () => {
    return gulp_1.src(path)
        .pipe(config())
        .pipe(rename('string-fun.d.ts'))
        .pipe(gulp_1.dest('src'));
};
gulp_1.task('build:sf', getConfigInterface);
//exports.buildConfig = getConfigInterface;
